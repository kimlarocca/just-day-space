import{h as E,g as d,j as O,r as p,o as t,c as y,u as e,b as P,i as C,f as c,a as s,k as I,w as M,d as k,F as Y,_ as j,t as B,p as G,e as J}from"./8BKww6Vf.js";import{u as F}from"./BrLtfxac.js";import{u as N}from"./CuZozit4.js";const L={key:0},R=s("h6",{class:"mb-2"},"Date of Birth",-1),H=s("p",{class:"small font-italic mb-4"}," Your date of birth is required - you must be 18 or older to book or list on Just Day Space. ",-1),K=s("h6",{class:"mb-2"},"Name",-1),Q=s("h6",{class:"mb-2"},"Bio",-1),W={class:"changes-saved-toast"},ce={__name:"ManageUserProfile",async setup(U){var _,w,b;let x,D;const l=E(),S=F(),h=N(),i=d(null),r=d(null),o=d(null),m=d([]),a=d(!1),V=new Date;V.setFullYear(V.getFullYear()-18);let{data:v}=([x,D]=O(()=>h.from("profiles").select("*").eq("id",l.value.id).limit(1)),x=await x,D(),x);v&&(m.value=v,i.value=(_=v[0])==null?void 0:_.full_name,r.value=(w=v[0])==null?void 0:w.birthday,o.value=(b=v[0])==null?void 0:b.bio);const n=async()=>{a.value=!1;const{error:f}=await h.from("profiles").upsert({id:l.value.id,updated_at:new Date().toISOString(),full_name:i.value,birthday:r.value,bio:o.value}).match({id:l.value.id});f?console.log("updateProfile error",f):(a.value=!0,S.value.full_name=i.value,S.value.birthday=r.value,S.value.bio=o.value)};return(f,u)=>{const g=p("Calendar"),q=p("InputText"),z=p("Textarea"),A=p("Message");return t(),y(Y,null,[e(m)&&e(m).length>0?(t(),y("div",L,[R,P(g,{modelValue:e(r),"onUpdate:modelValue":u[0]||(u[0]=$=>C(r)?r.value=$:null),maxDate:e(V),showIcon:"",placeholder:"Select A Date",class:"mb-2 w-full",onDateSelect:n},null,8,["modelValue","maxDate"]),H,K,P(q,{modelValue:e(i),"onUpdate:modelValue":u[1]||(u[1]=$=>C(i)?i.value=$:null),placeholder:"Enter your full name here",onChange:n,class:"mb-4"},null,8,["modelValue"]),Q,P(z,{modelValue:e(o),"onUpdate:modelValue":u[2]||(u[2]=$=>C(o)?o.value=$:null),rows:"5",placeholder:"Enter a brief paragraph about yourself - this may lead to more bookings!",onChange:n},null,8,["modelValue"])])):c("",!0),s("div",W,[e(a)?(t(),I(A,{key:0,class:"mb-4",severity:"success",closable:!1,sticky:!1},{default:M(()=>[k(" Your changes have been saved. ")]),_:1})):c("",!0)])],64)}}},T=U=>(G("data-v-a51024b3"),U=U(),J(),U),X={class:"upload-image"},Z=T(()=>s("h6",{class:"mb-4"},"Profile Image",-1)),ee={key:2},ae={key:0,class:"mb-3"},te={class:"flex"},oe={key:1,class:"small mt-3"},se=T(()=>s("em",null,[k(" Image files must be less than 1MB in size, and should ideally be a square."),s("br"),k("jpg, png, webp, and gif files are accepted. ")],-1)),le=[se],re={__name:"UploadImage",props:{image:{type:String,default:"",required:!0}},emits:["imageUploaded"],setup(U,{emit:x}){const D=x,l=E(),S=F(),h=N(),i=U,r=d(!1),o=d(),m=d(),a=d(i.image),V=async n=>{try{r.value=!0;const _=n.files[0],w=_.name.split(".").pop(),b=`${i.userId}-${Math.random()}.${w}`,{error:f}=await h.storage.from("avatars").upload(b,_);if(f)throw f;const{data:u}=await h.storage.from("avatars").getPublicUrl(b);a.value=u.publicUrl;const{error:g}=await h.from("profiles").upsert({id:l.value.id,updated_at:new Date().toISOString(),avatar_url:a.value}).match({id:l.value.id});g?(console.log(g),o.value=`Error: ${g}`):(m.value="Success! Your image has been saved.",S.value.avatar_url=a.value,D("imageUploaded"))}catch(_){o.value=`Error: ${_}`}finally{r.value=!1}},v=async()=>{const{error:n}=await h.from("profiles").upsert({id:l.value.id,updated_at:new Date().toISOString(),avatar_url:null}).match({id:l.value.id});n?(console.log(n),o.value=`Error: ${n}`):(m.value="Success! Your photo has been deleted.",a.value=null,S.value.avatar_url=null)};return(n,_)=>{const w=p("ProgressSpinner"),b=p("Avatar"),f=p("FileUpload"),u=p("Button"),g=p("Message");return t(),y("div",X,[Z,e(r)?(t(),I(w,{key:0,class:"inline-block mb-4"})):c("",!0),e(a)?(t(),I(b,{key:1,image:e(a),size:"xlarge",shape:"circle",alt:"profile photo",class:"mb-4"},null,8,["image"])):c("",!0),e(l).app_metadata.provider==="google"?(t(),y("p",ee,[s("em",null,[k(" You are using your "),s("strong",null,B(e(l).email),1),k(" Google account to login. To change your profile picture, you must do so through your Google account. ")])])):(t(),y(Y,{key:3},[e(a)?c("",!0):(t(),y("p",ae," You have not added a profile image yet. ")),s("div",te,[P(f,{mode:"basic",customUpload:!0,onUploader:V,accept:"image/*",maxFileSize:1e6,fileLimit:1,"choose-label":"Update",auto:!0,"upload-icon":"pi pi-image",class:"mr-2 fit-width black",style:{height:"36px","text-transform":"capitalize"}}),e(a)?(t(),I(u,{key:0,onClick:v,class:"black p-button-rounded",icon:"pi pi-trash"})):c("",!0)]),e(a)?c("",!0):(t(),y("p",oe,le))],64)),e(o)?(t(),I(g,{key:4,class:"mt-4",severity:"error"},{default:M(()=>[k(B(e(o)),1)]),_:1})):c("",!0),e(m)?(t(),I(g,{key:5,sticky:!1,life:5e3,class:"mt-4",severity:"success"},{default:M(()=>[k(B(e(m)),1)]),_:1})):c("",!0)])}}},de=j(re,[["__scopeId","data-v-a51024b3"]]);export{ce as _,de as a};
